<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>å‡æ³•è®­ç»ƒï¼ˆé”™è¯¯é—ªçƒ + è¯­éŸ³æç¤ºï¼‰</title>

<style>
body{
  font-family:"Comic Sans MS",sans-serif;
  background:#f7fff3;
  display:flex;flex-direction:column;align-items:center;
  margin:0;padding:0;
}
h1{margin:18px 0;color:#44aa55;}

.panel{width:100%;max-width:760px;text-align:center;}

button{
  background:#b8f1b2;border:none;border-radius:12px;
  padding:10px 18px;margin:6px;font-size:1.1em;
  box-shadow:2px 3px 0 #8ec78a;cursor:pointer;
}
button:hover{transform:scale(1.03);}

/* grid */
#gridHint{
  margin-top:12px;display:none;flex-direction:column;
  align-items:center;gap:6px;
}
.gridBox{
  display:grid;
  grid-template-columns:repeat(5,52px);
  grid-template-rows:repeat(2,52px);
  gap:8px;
}
.gridCell{
  width:52px;height:52px;border-radius:8px;
  background:#fff4e0;border:2px solid #ffd2a0;
  transition:opacity .25s,transform .25s;
}
.gridCell.filled{
  background:#ffa94d;border-color:#ff8f1f;
  transform:scale(1.06);
}
.flash{
  animation:flashAnim .6s infinite;
}
@keyframes flashAnim {
  0%{opacity:1;}
  50%{opacity:0.15;}
  100%{opacity:1;}
}

#gridNumber{
  font-size:2em;font-weight:bold;color:#ff8800;
}

#question{
  margin-top:20px;font-size:2.2em;color:#3b8c49;
}

#answerInput{
  width:100px;height:60px;font-size:2em;text-align:center;
  border:3px solid #8cd88f;border-radius:12px;
  background:#fafff9;margin-top:12px;
}

#keypad{display:none;margin-top:12px;flex-wrap:wrap;justify-content:center;gap:8px;}
.keybtn{
  width:70px;height:70px;font-size:1.6em;
  border:none;border-radius:10px;background:#d8f8d4;
  box-shadow:2px 2px 0 #9ccc9b;cursor:pointer;
}

.wide{width:150px;}

#stats{margin-top:12px;color:#555;font-size:1.1em;}

</style>
</head>
<body>

<h1>ä¸€å¹´çº§å‡æ³•è®­ç»ƒ</h1>

<div id="modeSelect" class="panel">
  <button onclick="startNormal()">æ™®é€šæ¨¡å¼</button>
</div>

<div id="game" class="panel" style="display:none;">
  
  <button onclick="returnHome()" style="margin-top:10px;">ğŸ  è¿”å›é¦–é¡µ</button>

  <div id="gridHint">
    <div class="gridBox" id="gridBox"></div>
    <div id="gridNumber"></div>
  </div>

  <div id="question"></div>

  <input id="answerInput" readonly placeholder="?" onclick="toggleKeypad()"/>

  <div id="keypad">
    <div style="display:flex;gap:8px;">
      <button class="keybtn" onclick="press(0)">0</button>
      <button class="keybtn" onclick="press(1)">1</button>
      <button class="keybtn" onclick="press(2)">2</button>
      <button class="keybtn" onclick="press(3)">3</button>
      <button class="keybtn" onclick="press(4)">4</button>
      <button class="keybtn" onclick="press(5)">5</button>
    </div>
    <div style="display:flex;gap:8px;margin-top:8px;">
      <button class="keybtn" onclick="press(6)">6</button>
      <button class="keybtn" onclick="press(7)">7</button>
      <button class="keybtn" onclick="press(8)">8</button>
      <button class="keybtn" onclick="press(9)">9</button>
      <button class="keybtn" onclick="press(10)">10</button>
    </div>
    <div style="margin-top:12px;display:flex;gap:10px;justify-content:center;">
      <button class="keybtn wide" onclick="submitAnswer()">ç¡®å®š</button>
      <button class="keybtn wide" onclick="clearInput()">æ¸…é™¤</button>
    </div>
  </div>

  <div id="stats"></div>
</div>

<script>
let currentA=0,currentB=0;
let wrongShown=false;
let flashCells=[];
let flashTimer=null;

/* ---------- åŸºç¡€ ---------- */
function startNormal(){
  document.getElementById('modeSelect').style.display='none';
  document.getElementById('game').style.display='block';
  nextQuestion();
}

function returnHome(){
  stopFlash();
  document.getElementById('game').style.display='none';
  document.getElementById('modeSelect').style.display='block';
}

/* ---------- å‡ºé¢˜ ---------- */
function nextQuestion(){
  stopFlash();
  hideGridHint();
  clearInput();
  wrongShown=false;

  currentA = rand(2,9);
  currentB = rand(0,currentA-1);

  document.getElementById("question").innerText = `${currentA} - ${currentB} = ?`;
  updateStats();
}

/* ---------- æ•°å­—é”®ç›˜ ---------- */
function press(n){
  document.getElementById("answerInput").value = n;
}
function clearInput(){
  document.getElementById("answerInput").value = "";
}
function toggleKeypad(){
  const k=document.getElementById("keypad");
  k.style.display = (k.style.display==="flex") ? "none" : "flex";
}

/* ---------- æäº¤ç­”æ¡ˆ ---------- */
function submitAnswer(){
  const v=document.getElementById("answerInput").value;
  if(v==="") return alert("è¯·è¾“å…¥ç­”æ¡ˆï¼");
  const ans=parseInt(v);
  const right=currentA-currentB;

  if(ans===right){
    nextQuestion();
  } else {
    if(!wrongShown){
      wrongShown=true;
      showGridWithFlash(currentA, currentB);
      playVoice(currentB, right);
    }
  }
  updateStats();
}

/* ---------- æ˜¾ç¤ºæ ¼å­ + B ä¸ªé—ªçƒ ---------- */
function showGridWithFlash(a,b){
  const hint=document.getElementById('gridHint');
  const box=document.getElementById('gridBox');
  const lbl=document.getElementById('gridNumber');

  box.innerHTML='';
  flashCells=[];

  for(let i=0;i<10;i++){
    const d=document.createElement('div');
    d.className='gridCell';
    if(i<a) d.classList.add('filled');
    box.appendChild(d);
    flashCells.push(d);
  }

  lbl.innerText=a;
  hint.style.display='flex';

  /* æœ€å b ä¸ªæ ¼å­é—ªçƒ */
  let startIndex = a - b;
  for(let i=startIndex;i<a;i++){
    flashCells[i].classList.add('flash');
  }
}

/* ---------- åœæ­¢é—ªçƒ ---------- */
function stopFlash(){
  flashCells.forEach(c=>c.classList.remove('flash'));
  flashCells=[];
}

/* ---------- éšè—æ ¼å­ ---------- */
function hideGridHint(){
  document.getElementById('gridHint').style.display='none';
}

/* ---------- è¯­éŸ³æç¤º ---------- */
function playVoice(b, remain){
  let msg = new SpeechSynthesisUtterance(`å‰ªæ‰ ${b} ä¸ªï¼Œè¿˜å‰© ${remain} ä¸ª`);
  msg.lang = "zh-CN";
  speechSynthesis.speak(msg);
}

/* ---------- stats ---------- */
function updateStats(){
  document.getElementById("stats").innerText =
    `æœ¬é¢˜ï¼š${currentA} - ${currentB}`;
}

/* ---------- å·¥å…· ---------- */
function rand(a,b){return Math.floor(Math.random()*(b-a+1))+a;}
</script>

</body>
</html>
